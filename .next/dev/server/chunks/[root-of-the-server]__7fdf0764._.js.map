{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/javieroviedo/Documents/v0-room-tuner-mvp/lib/acousticsCalculations.ts"],"sourcesContent":["// Room Acoustics Calculations\n// Based on established acoustic physics formulas\n\nimport type { RoomProject } from \"@/app/types/room\"\n\n// Speed of sound in air at 20°C (m/s)\nconst SPEED_OF_SOUND = 343\n\n// ===== ROOM MODES =====\n\nexport interface RoomMode {\n  frequency: number\n  type: 'axial' | 'tangential' | 'oblique'\n  dimension: 'length' | 'width' | 'height' | 'mixed'\n  severity: 'high' | 'medium' | 'low'\n  description: string\n}\n\n/**\n * Calculate axial room modes (most significant)\n * Formula: f = (n * c) / (2 * L)\n * where n = mode number, c = speed of sound, L = dimension\n */\nexport function calculateRoomModes(\n  length: number,\n  width: number,\n  height: number\n): RoomMode[] {\n  const modes: RoomMode[] = []\n\n  // Calculate first 5 modes for each dimension (axial modes)\n  for (let n = 1; n <= 5; n++) {\n    // Length modes\n    const lengthFreq = (n * SPEED_OF_SOUND) / (2 * length)\n    modes.push({\n      frequency: Math.round(lengthFreq * 10) / 10,\n      type: 'axial',\n      dimension: 'length',\n      severity: n === 1 ? 'high' : n <= 3 ? 'medium' : 'low',\n      description: `${n}° modo longitudinal (${length}m)`\n    })\n\n    // Width modes\n    const widthFreq = (n * SPEED_OF_SOUND) / (2 * width)\n    modes.push({\n      frequency: Math.round(widthFreq * 10) / 10,\n      type: 'axial',\n      dimension: 'width',\n      severity: n === 1 ? 'high' : n <= 3 ? 'medium' : 'low',\n      description: `${n}° modo transversal (${width}m)`\n    })\n\n    // Height modes\n    const heightFreq = (n * SPEED_OF_SOUND) / (2 * height)\n    modes.push({\n      frequency: Math.round(heightFreq * 10) / 10,\n      type: 'axial',\n      dimension: 'height',\n      severity: n === 1 ? 'high' : n <= 3 ? 'medium' : 'low',\n      description: `${n}° modo vertical (${height}m)`\n    })\n  }\n\n  // Sort by frequency and remove duplicates within 5Hz\n  return modes\n    .sort((a, b) => a.frequency - b.frequency)\n    .filter((mode, index, arr) => {\n      if (index === 0) return true\n      return Math.abs(mode.frequency - arr[index - 1].frequency) > 5\n    })\n}\n\n/**\n * Identify problematic room modes (below 300Hz, high severity)\n */\nexport function getProblematicModes(modes: RoomMode[]): RoomMode[] {\n  return modes.filter(\n    (mode) => mode.frequency < 300 && mode.severity === 'high'\n  )\n}\n\n// ===== RT60 ESTIMATION =====\n\n/**\n * Estimate RT60 using Sabine equation\n * RT60 = 0.161 * V / A\n * where V = volume (m³), A = total absorption (sabins)\n */\nexport function estimateRT60(\n  volume: number,\n  totalAbsorption: number\n): number {\n  if (totalAbsorption === 0) return 10 // Very reflective room\n  const rt60 = (0.161 * volume) / totalAbsorption\n  return Math.round(rt60 * 100) / 100\n}\n\n/**\n * Calculate RT60 for different frequency bands\n */\nexport function estimateRT60ByBand(\n  volume: number,\n  absorption: { low: number; mid: number; high: number }\n): {\n  low: number // 63-250 Hz\n  mid: number // 500-2k Hz\n  high: number // 4k-16k Hz\n} {\n  return {\n    low: estimateRT60(volume, absorption.low),\n    mid: estimateRT60(volume, absorption.mid),\n    high: estimateRT60(volume, absorption.high),\n  }\n}\n\n/**\n * Determine if RT60 is appropriate for room purpose\n */\nexport function evaluateRT60(\n  rt60: number,\n  purpose: 'music' | 'instrument' | 'work'\n): {\n  rating: 'good' | 'acceptable' | 'problematic'\n  message: string\n} {\n  const idealRanges = {\n    music: { min: 0.3, max: 0.5 },\n    instrument: { min: 0.4, max: 0.7 },\n    work: { min: 0.2, max: 0.4 },\n  }\n\n  const range = idealRanges[purpose]\n\n  if (rt60 >= range.min && rt60 <= range.max) {\n    return {\n      rating: 'good',\n      message: `RT60 ideal para ${purpose === 'music' ? 'escuchar música' : purpose === 'instrument' ? 'tocar instrumento' : 'trabajar'}`,\n    }\n  } else if (rt60 < range.min) {\n    return {\n      rating: 'problematic',\n      message: 'Sala demasiado seca, falta reverberación natural',\n    }\n  } else if (rt60 < range.max * 1.5) {\n    return {\n      rating: 'acceptable',\n      message: 'RT60 ligeramente alto, considerar agregar absorción',\n    }\n  } else {\n    return {\n      rating: 'problematic',\n      message: 'Sala demasiado viva, exceso de reverberación',\n    }\n  }\n}\n\n// ===== MATERIAL ABSORPTION COEFFICIENTS =====\n\nexport const absorptionCoefficients = {\n  floor: {\n    madera: { low: 0.15, mid: 0.10, high: 0.10 },\n    ceramico: { low: 0.01, mid: 0.01, high: 0.02 },\n    alfombra: { low: 0.10, mid: 0.40, high: 0.60 },\n    otro: { low: 0.05, mid: 0.05, high: 0.05 },\n  },\n  wall: {\n    desnudas: { low: 0.02, mid: 0.02, high: 0.03 },\n    cuadros: { low: 0.05, mid: 0.10, high: 0.15 },\n    bibliotecas: { low: 0.10, mid: 0.25, high: 0.40 },\n    mixto: { low: 0.06, mid: 0.15, high: 0.20 },\n  },\n  furniture: {\n    sofa: { low: 0.25, mid: 0.35, high: 0.40 },\n    escritorio: { low: 0.05, mid: 0.10, high: 0.10 },\n    estanteria: { low: 0.10, mid: 0.20, high: 0.30 },\n    silla: { low: 0.05, mid: 0.15, high: 0.20 },\n    mesa: { low: 0.03, mid: 0.08, high: 0.10 },\n  },\n}\n\n// ===== ABSORPTION CALCULATIONS =====\n\n/**\n * Calculate total absorption in sabins\n * Sabin = Area (m²) × Absorption Coefficient\n */\nexport function calculateTotalAbsorption(project: RoomProject): {\n  low: number\n  mid: number\n  high: number\n  average: number\n} {\n  const {\n    lengthM = 0,\n    widthM = 0,\n    heightM = 0,\n    floorType,\n    wallType,\n    furniture = [],\n  } = project\n\n  // Calculate surface areas\n  const floorArea = lengthM * widthM\n  const wallArea = 2 * (lengthM * heightM + widthM * heightM)\n  const ceilingArea = floorArea\n\n  // Get absorption coefficients\n  const floorCoeff = absorptionCoefficients.floor[floorType || 'otro']\n  const wallCoeff = absorptionCoefficients.wall[wallType || 'desnudas']\n  const ceilingCoeff = { low: 0.02, mid: 0.02, high: 0.03 } // Assume hard ceiling\n\n  // Calculate base absorption from surfaces\n  let absorption = {\n    low: floorArea * floorCoeff.low + wallArea * wallCoeff.low + ceilingArea * ceilingCoeff.low,\n    mid: floorArea * floorCoeff.mid + wallArea * wallCoeff.mid + ceilingArea * ceilingCoeff.mid,\n    high: floorArea * floorCoeff.high + wallArea * wallCoeff.high + ceilingArea * ceilingCoeff.high,\n  }\n\n  // Add furniture contribution (assume ~1m² effective area per item)\n  furniture.forEach((item) => {\n    const furnitureKey = item as keyof typeof absorptionCoefficients.furniture\n    const furnitureCoeff = absorptionCoefficients.furniture[furnitureKey]\n    if (furnitureCoeff) {\n      absorption.low += furnitureCoeff.low\n      absorption.mid += furnitureCoeff.mid\n      absorption.high += furnitureCoeff.high\n    }\n  })\n\n  const average = (absorption.low + absorption.mid + absorption.high) / 3\n\n  return {\n    ...absorption,\n    average: Math.round(average * 100) / 100,\n  }\n}\n\n// ===== ROOM RATIOS =====\n\n/**\n * Calculate room dimension ratios\n * Good ratios help avoid coincident room modes\n */\nexport function calculateRoomRatios(\n  length: number,\n  width: number,\n  height: number\n): {\n  lengthWidth: number\n  lengthHeight: number\n  widthHeight: number\n  rating: 'good' | 'acceptable' | 'poor'\n  message: string\n} {\n  const lengthWidth = Math.round((length / width) * 100) / 100\n  const lengthHeight = Math.round((length / height) * 100) / 100\n  const widthHeight = Math.round((width / height) * 100) / 100\n\n  // Ideal room ratios (Bolt's criteria and others)\n  // Avoid 1:1:1 (cube), 1:2:3, 1:2:4, and other simple integer ratios\n  const isGoodRatio = (ratio: number) => {\n    // Avoid ratios very close to integers\n    const nearestInt = Math.round(ratio)\n    const distanceFromInt = Math.abs(ratio - nearestInt)\n    return distanceFromInt > 0.15\n  }\n\n  const goodRatios = [\n    isGoodRatio(lengthWidth),\n    isGoodRatio(lengthHeight),\n    isGoodRatio(widthHeight),\n  ]\n  const goodCount = goodRatios.filter(Boolean).length\n\n  let rating: 'good' | 'acceptable' | 'poor'\n  let message: string\n\n  if (goodCount === 3) {\n    rating = 'good'\n    message = 'Proporciones favorables, bajo riesgo de modos coincidentes'\n  } else if (goodCount >= 2) {\n    rating = 'acceptable'\n    message = 'Proporciones aceptables, algunos modos pueden coincidir'\n  } else {\n    rating = 'poor'\n    message = 'Proporciones problemáticas, probable acumulación modal'\n  }\n\n  return {\n    lengthWidth,\n    lengthHeight,\n    widthHeight,\n    rating,\n    message,\n  }\n}\n\n// ===== FREQUENCY RESPONSE ESTIMATION =====\n\n/**\n * Generate estimated frequency response based on room characteristics\n * This is a simplified model for visualization purposes\n */\nexport function estimateFrequencyResponse(\n  roomModes: RoomMode[],\n  roomCharacter: 'viva' | 'equilibrada' | 'seca',\n  volume: number\n): Array<{ frequency: number; response: number; issue: boolean; description?: string }> {\n  const response: Array<{ frequency: number; response: number; issue: boolean; description?: string }> = []\n\n  // Generate response curve from 20Hz to 20kHz (logarithmic spacing)\n  const frequencies = [\n    20, 25, 31.5, 40, 50, 63, 80, 100, 125, 160, 200, 250, 315, 400, 500,\n    630, 800, 1000, 1250, 1600, 2000, 2500, 3150, 4000, 5000, 6300, 8000,\n    10000, 12500, 16000, 20000,\n  ]\n\n  // Base response depends on room character\n  const baseResponse = {\n    viva: 0, // Reverberant room boosts everything\n    equilibrada: -2, // Balanced room slight roll-off\n    seca: -4, // Dead room more roll-off\n  }[roomCharacter]\n\n  frequencies.forEach((freq) => {\n    let responseDb = baseResponse\n\n    // Low frequency: affected by room modes\n    if (freq < 300) {\n      // Find nearby room modes\n      const nearbyModes = roomModes.filter(\n        (mode) => Math.abs(mode.frequency - freq) < 10\n      )\n      if (nearbyModes.length > 0) {\n        // Boost at room mode frequencies\n        const maxSeverity = nearbyModes.some((m) => m.severity === 'high') ? 12 :\n                            nearbyModes.some((m) => m.severity === 'medium') ? 6 : 3\n        responseDb += maxSeverity\n      }\n\n      // Small rooms have less bass extension\n      if (volume < 30) {\n        const bassRolloff = ((300 - freq) / 300) * -6\n        responseDb += bassRolloff\n      }\n    }\n\n    // Mid frequency: relatively flat, affected by room character\n    if (freq >= 300 && freq < 4000) {\n      if (roomCharacter === 'viva') {\n        responseDb += Math.random() * 4 - 2 // ±2dB variance\n      } else if (roomCharacter === 'seca') {\n        responseDb -= 2\n      }\n    }\n\n    // High frequency: affected by absorption\n    if (freq >= 4000) {\n      if (roomCharacter === 'seca') {\n        responseDb -= ((freq - 4000) / 16000) * 8 // Roll off highs\n      } else if (roomCharacter === 'viva') {\n        responseDb += 2 // Bright\n      }\n    }\n\n    // Mark as issue if response deviates more than ±6dB from target\n    const isIssue = Math.abs(responseDb) > 6\n\n    response.push({\n      frequency: freq,\n      response: Math.round(responseDb * 10) / 10,\n      issue: isIssue,\n      description: isIssue\n        ? responseDb > 6\n          ? `Pico de +${responseDb.toFixed(1)}dB`\n          : `Valle de ${responseDb.toFixed(1)}dB`\n        : undefined,\n    })\n  })\n\n  return response\n}\n\n// ===== ROOM CHARACTER DETERMINATION =====\n\n/**\n * Determine room acoustic character based on RT60 and absorption\n */\nexport function determineRoomCharacter(\n  rt60Mid: number,\n  totalAbsorption: number,\n  surfaceArea: number\n): 'viva' | 'equilibrada' | 'seca' {\n  const avgAbsorptionCoeff = totalAbsorption / surfaceArea\n\n  // Viva: Long RT60, low absorption\n  if (rt60Mid > 0.6 || avgAbsorptionCoeff < 0.15) {\n    return 'viva'\n  }\n\n  // Seca: Short RT60, high absorption\n  if (rt60Mid < 0.3 || avgAbsorptionCoeff > 0.35) {\n    return 'seca'\n  }\n\n  // Equilibrada: Moderate RT60 and absorption\n  return 'equilibrada'\n}\n\n// ===== ROOM METRICS SUMMARY =====\n\nexport interface RoomMetrics {\n  volume: number // m³\n  surfaceArea: number // m²\n  floorArea: number // m²\n  wallArea: number // m²\n  ceilingArea: number // m²\n  ratios: {\n    lengthWidth: number\n    lengthHeight: number\n    widthHeight: number\n    rating: 'good' | 'acceptable' | 'poor'\n    message: string\n  }\n}\n\n/**\n * Calculate comprehensive room metrics\n */\nexport function calculateRoomMetrics(\n  length: number,\n  width: number,\n  height: number\n): RoomMetrics {\n  const volume = Math.round(length * width * height * 100) / 100\n  const floorArea = Math.round(length * width * 100) / 100\n  const wallArea = Math.round(2 * (length * height + width * height) * 100) / 100\n  const ceilingArea = floorArea\n  const surfaceArea = Math.round((floorArea + wallArea + ceilingArea) * 100) / 100\n\n  const ratios = calculateRoomRatios(length, width, height)\n\n  return {\n    volume,\n    surfaceArea,\n    floorArea,\n    wallArea,\n    ceilingArea,\n    ratios,\n  }\n}\n\n// ===== SPEAKER PLACEMENT =====\n\n/**\n * Calculate optimal speaker and listening positions\n * Returns positions as percentages of room dimensions (0-1)\n */\nexport function calculateOptimalPositions(\n  length: number,\n  width: number,\n  equipmentPosition: 'pared_larga' | 'pared_corta' | 'indefinido'\n): {\n  speakers: Array<{ x: number; y: number }> // Normalized 0-1\n  listeningPosition: { x: number; y: number } // Normalized 0-1\n  recommendations: string[]\n} {\n  const recommendations: string[] = []\n\n  // Default: speakers on short wall (most common)\n  let speakerWall: 'short' | 'long' = 'short'\n\n  if (equipmentPosition === 'pared_larga') {\n    speakerWall = 'long'\n  } else if (equipmentPosition === 'pared_corta') {\n    speakerWall = 'short'\n  } else {\n    // Auto-determine: prefer short wall if room is not too wide\n    speakerWall = width / length > 0.7 ? 'short' : 'long'\n  }\n\n  let speakers: Array<{ x: number; y: number }>\n  let listeningPosition: { x: number; y: number }\n\n  if (speakerWall === 'short') {\n    // Speakers on short wall (width direction)\n    const speakerDistanceFromWall = 0.15 // 15% from front wall\n    const speakerSpacing = 0.35 // 35% from side walls\n\n    speakers = [\n      { x: speakerSpacing, y: speakerDistanceFromWall },\n      { x: 1 - speakerSpacing, y: speakerDistanceFromWall },\n    ]\n\n    // Listening position: 38% rule (avoid 50% which is room mode null)\n    listeningPosition = { x: 0.5, y: 0.38 }\n\n    recommendations.push(`Parlantes separados ${Math.round(width * (1 - 2 * speakerSpacing) * 100) / 100}m`)\n    recommendations.push(`Punto de escucha a ${Math.round(length * 0.38 * 100) / 100}m de pared frontal`)\n  } else {\n    // Speakers on long wall (length direction)\n    const speakerDistanceFromWall = 0.15\n    const speakerSpacing = 0.35\n\n    speakers = [\n      { x: speakerDistanceFromWall, y: speakerSpacing },\n      { x: speakerDistanceFromWall, y: 1 - speakerSpacing },\n    ]\n\n    listeningPosition = { x: 0.38, y: 0.5 }\n\n    recommendations.push(`Configuración en pared larga`)\n    recommendations.push(`Parlantes separados ${Math.round(length * (1 - 2 * speakerSpacing) * 100) / 100}m`)\n  }\n\n  recommendations.push('Formar triángulo equilátero con punto de escucha')\n  recommendations.push('Evitar esquinas para los parlantes')\n\n  return {\n    speakers,\n    listeningPosition,\n    recommendations,\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 501, "column": 0}, "map": {"version":3,"sources":["file:///Users/javieroviedo/Documents/v0-room-tuner-mvp/lib/acousticProducts.ts"],"sourcesContent":["// Acoustic Products Database with Real Pricing\n// Prices updated as of 2025 - USD and ARS\n\nexport interface AcousticProduct {\n  id: string\n  name: string\n  category: 'absorber' | 'bass_trap' | 'diffuser' | 'rug' | 'curtain' | 'misc'\n  priceUSD: number\n  priceARS: number\n  supplier: string\n  link: string\n  absorptionCoefficient?: number     // At 1kHz\n  coverage?: number                  // m² per unit\n  thickness?: number                 // cm\n  installation: 'easy' | 'moderate' | 'professional'\n  description: string\n}\n\nexport const acousticProductsDB: AcousticProduct[] = [\n  // ===== ABSORBERS =====\n  {\n    id: 'foam-panel-5cm',\n    name: 'Acoustic Foam Panel 60x60cm (5cm)',\n    category: 'absorber',\n    priceUSD: 12,\n    priceARS: 12000,\n    supplier: 'Amazon / MercadoLibre',\n    link: 'https://www.amazon.com/s?k=acoustic+foam+panels',\n    absorptionCoefficient: 0.65,\n    coverage: 0.36,\n    thickness: 5,\n    installation: 'easy',\n    description: 'Basic foam panel for mid-high frequency absorption. Good for first reflections and flutter echo.'\n  },\n  {\n    id: 'foam-panel-10cm',\n    name: 'Acoustic Foam Panel 60x60cm (10cm)',\n    category: 'absorber',\n    priceUSD: 18,\n    priceARS: 18000,\n    supplier: 'Amazon / MercadoLibre',\n    link: 'https://www.amazon.com/s?k=thick+acoustic+foam',\n    absorptionCoefficient: 0.80,\n    coverage: 0.36,\n    thickness: 10,\n    installation: 'easy',\n    description: 'Thicker foam for better mid-frequency absorption. More effective than 5cm panels.'\n  },\n  {\n    id: 'pro-fabric-panel-5cm',\n    name: 'Fabric-Wrapped Panel 60x120cm (5cm)',\n    category: 'absorber',\n    priceUSD: 45,\n    priceARS: 45000,\n    supplier: 'ATS Acoustics / Local',\n    link: 'https://www.atsacoustics.com/',\n    absorptionCoefficient: 0.85,\n    coverage: 0.72,\n    thickness: 5,\n    installation: 'moderate',\n    description: 'Professional fabric-wrapped fiberglass panel. Better aesthetics and performance than foam.'\n  },\n  {\n    id: 'pro-fabric-panel-10cm',\n    name: 'Fabric-Wrapped Panel 60x120cm (10cm)',\n    category: 'absorber',\n    priceUSD: 85,\n    priceARS: 85000,\n    supplier: 'GIK Acoustics / ATS',\n    link: 'https://www.gikacoustics.com/',\n    absorptionCoefficient: 0.95,\n    coverage: 0.72,\n    thickness: 10,\n    installation: 'moderate',\n    description: 'High-performance broadband absorber. Excellent for critical listening environments.'\n  },\n  {\n    id: 'ceiling-cloud-panel',\n    name: 'Ceiling Cloud Panel 120x120cm (10cm)',\n    category: 'absorber',\n    priceUSD: 120,\n    priceARS: 120000,\n    supplier: 'Acoustics First',\n    link: 'https://www.acousticsfirst.com/',\n    absorptionCoefficient: 0.95,\n    coverage: 1.44,\n    thickness: 10,\n    installation: 'professional',\n    description: 'Large ceiling-mounted panel for overhead reflection control.'\n  },\n\n  // ===== BASS TRAPS =====\n  {\n    id: 'corner-bass-trap-60cm',\n    name: 'Corner Bass Trap 30x30x60cm',\n    category: 'bass_trap',\n    priceUSD: 65,\n    priceARS: 65000,\n    supplier: 'GIK Acoustics / Primacoustic',\n    link: 'https://www.gikacoustics.com/product/gik-acoustics-tri-trap/',\n    absorptionCoefficient: 0.75,\n    installation: 'moderate',\n    description: 'Corner-mounted bass trap for low frequency control. Treats problematic room modes.'\n  },\n  {\n    id: 'corner-bass-trap-120cm',\n    name: 'Corner Bass Trap 30x30x120cm',\n    category: 'bass_trap',\n    priceUSD: 120,\n    priceARS: 120000,\n    supplier: 'GIK Acoustics',\n    link: 'https://www.gikacoustics.com/',\n    absorptionCoefficient: 0.85,\n    installation: 'moderate',\n    description: 'Full-height corner bass trap. Maximum low-frequency absorption for serious rooms.'\n  },\n  {\n    id: 'soffit-bass-trap',\n    name: 'Soffit Bass Trap 60x60x30cm',\n    category: 'bass_trap',\n    priceUSD: 95,\n    priceARS: 95000,\n    supplier: 'GIK Acoustics / Real Traps',\n    link: 'https://www.gikacoustics.com/',\n    absorptionCoefficient: 0.90,\n    installation: 'moderate',\n    description: 'Wall-ceiling junction trap. Treats bass buildup at boundaries.'\n  },\n  {\n    id: 'membrane-bass-trap',\n    name: 'Membrane Bass Trap 60x120cm',\n    category: 'bass_trap',\n    priceUSD: 180,\n    priceARS: 180000,\n    supplier: 'GIK Acoustics / Artnovion',\n    link: 'https://www.gikacoustics.com/product/gik-acoustics-monster-bass-trap-flexrange-technology/',\n    absorptionCoefficient: 0.95,\n    installation: 'professional',\n    description: 'Tuned membrane absorber for specific low frequencies. Professional-grade solution.'\n  },\n\n  // ===== DIFFUSERS =====\n  {\n    id: 'qrd-diffuser-small',\n    name: 'QRD Diffuser 60x60cm',\n    category: 'diffuser',\n    priceUSD: 85,\n    priceARS: 85000,\n    supplier: 'Acoustics First / Vicoustic',\n    link: 'https://www.acousticsfirst.com/',\n    installation: 'moderate',\n    description: 'Quadratic residue diffuser. Scatters sound evenly without absorbing energy.'\n  },\n  {\n    id: 'qrd-diffuser-large',\n    name: 'QRD Diffuser 60x120cm',\n    category: 'diffuser',\n    priceUSD: 140,\n    priceARS: 140000,\n    supplier: 'Acoustics First / RPG',\n    link: 'https://www.rpgacoustic.com/',\n    installation: 'moderate',\n    description: 'Large diffuser for rear wall. Creates spacious, natural sound field.'\n  },\n  {\n    id: 'skyline-diffuser',\n    name: 'Skyline Diffuser 60x60cm',\n    category: 'diffuser',\n    priceUSD: 95,\n    priceARS: 95000,\n    supplier: 'Acoustics First / DIY',\n    link: 'https://www.acousticsfirst.com/',\n    installation: 'moderate',\n    description: '2D diffuser with multi-directional scattering. Great for mixing positions.'\n  },\n  {\n    id: 'poly-diffuser',\n    name: 'Poly Cylindrical Diffuser 60x60cm',\n    category: 'diffuser',\n    priceUSD: 110,\n    priceARS: 110000,\n    supplier: 'Vicoustic / RPG',\n    link: 'https://www.vicoustic.com/',\n    installation: 'moderate',\n    description: 'Curved poly diffuser. Broadband diffusion with modern aesthetics.'\n  },\n\n  // ===== RUGS & CARPETS =====\n  {\n    id: 'thick-rug-small',\n    name: 'Thick Area Rug 1.5x2m',\n    category: 'rug',\n    priceUSD: 80,\n    priceARS: 80000,\n    supplier: 'IKEA / Local stores',\n    link: '',\n    absorptionCoefficient: 0.30,\n    coverage: 3,\n    installation: 'easy',\n    description: 'Medium pile rug for small rooms. Reduces floor reflections.'\n  },\n  {\n    id: 'thick-rug-medium',\n    name: 'Thick Area Rug 2x3m',\n    category: 'rug',\n    priceUSD: 150,\n    priceARS: 150000,\n    supplier: 'IKEA / Local stores',\n    link: '',\n    absorptionCoefficient: 0.35,\n    coverage: 6,\n    installation: 'easy',\n    description: 'Large thick pile rug. Essential for first reflection point between speakers and listener.'\n  },\n  {\n    id: 'thick-rug-large',\n    name: 'Thick Area Rug 3x4m',\n    category: 'rug',\n    priceUSD: 280,\n    priceARS: 280000,\n    supplier: 'Specialty carpet stores',\n    link: '',\n    absorptionCoefficient: 0.40,\n    coverage: 12,\n    installation: 'easy',\n    description: 'Extra large rug for comprehensive floor treatment in bigger rooms.'\n  },\n\n  // ===== CURTAINS =====\n  {\n    id: 'light-curtain',\n    name: 'Light Curtain Fabric (per m²)',\n    category: 'curtain',\n    priceUSD: 15,\n    priceARS: 15000,\n    supplier: 'Local fabric stores',\n    link: '',\n    absorptionCoefficient: 0.25,\n    installation: 'easy',\n    description: 'Light fabric curtain. Basic window treatment for high-frequency control.'\n  },\n  {\n    id: 'medium-curtain',\n    name: 'Medium Weight Curtain (per m²)',\n    category: 'curtain',\n    priceUSD: 25,\n    priceARS: 25000,\n    supplier: 'Local fabric stores',\n    link: '',\n    absorptionCoefficient: 0.40,\n    installation: 'easy',\n    description: 'Heavier curtain fabric. Better absorption across frequency range.'\n  },\n  {\n    id: 'heavy-curtain',\n    name: 'Heavy Acoustic Curtain (per m²)',\n    category: 'curtain',\n    priceUSD: 40,\n    priceARS: 40000,\n    supplier: 'Acoustic specialty stores',\n    link: '',\n    absorptionCoefficient: 0.55,\n    installation: 'easy',\n    description: 'Multi-layer acoustic curtain. Excellent for window and door treatment.'\n  },\n  {\n    id: 'blackout-acoustic-curtain',\n    name: 'Blackout Acoustic Curtain (per m²)',\n    category: 'curtain',\n    priceUSD: 55,\n    priceARS: 55000,\n    supplier: 'Acoustic specialty stores',\n    link: '',\n    absorptionCoefficient: 0.65,\n    installation: 'easy',\n    description: 'Premium curtain with blackout and acoustic properties. Blocks light and sound.'\n  },\n\n  // ===== MISCELLANEOUS =====\n  {\n    id: 'door-seal-kit',\n    name: 'Door Seal Kit (weatherstripping)',\n    category: 'misc',\n    priceUSD: 25,\n    priceARS: 25000,\n    supplier: 'Hardware stores',\n    link: '',\n    installation: 'easy',\n    description: 'Rubber seal for door gaps. Reduces sound leakage and external noise.'\n  },\n  {\n    id: 'window-plug',\n    name: 'Window Plug Insert (custom size)',\n    category: 'misc',\n    priceUSD: 60,\n    priceARS: 60000,\n    supplier: 'DIY / Custom',\n    link: '',\n    absorptionCoefficient: 0.80,\n    installation: 'moderate',\n    description: 'Removable insulated plug for windows. Dramatically reduces noise when needed.'\n  },\n  {\n    id: 'isolation-pads',\n    name: 'Speaker Isolation Pads (pair)',\n    category: 'misc',\n    priceUSD: 35,\n    priceARS: 35000,\n    supplier: 'Amazon / Music stores',\n    link: 'https://www.amazon.com/s?k=speaker+isolation+pads',\n    installation: 'easy',\n    description: 'Foam/rubber pads to decouple speakers from surfaces. Tightens bass response.'\n  },\n  {\n    id: 'bass-shaker',\n    name: 'Bass Shaker / Tactile Transducer',\n    category: 'misc',\n    priceUSD: 50,\n    priceARS: 50000,\n    supplier: 'Music/Audio stores',\n    link: 'https://www.amazon.com/s?k=bass+shaker',\n    installation: 'moderate',\n    description: 'Adds tactile bass feel without acoustic bass problems. Mounts to furniture.'\n  },\n  {\n    id: 'measurement-mic',\n    name: 'USB Measurement Microphone',\n    category: 'misc',\n    priceUSD: 80,\n    priceARS: 80000,\n    supplier: 'Amazon / MiniDSP',\n    link: 'https://www.minidsp.com/products/acoustic-measurement/umik-1',\n    installation: 'easy',\n    description: 'Calibrated mic for room measurements. Use with REW software to measure actual performance.'\n  },\n  {\n    id: 'acoustic-caulk',\n    name: 'Acoustic Sealant (tube)',\n    category: 'misc',\n    priceUSD: 12,\n    priceARS: 12000,\n    supplier: 'Hardware stores',\n    link: '',\n    installation: 'easy',\n    description: 'Flexible sealant for gaps and cracks. Prevents sound leaks through small openings.'\n  },\n  {\n    id: 'mass-loaded-vinyl',\n    name: 'Mass Loaded Vinyl (per m²)',\n    category: 'misc',\n    priceUSD: 35,\n    priceARS: 35000,\n    supplier: 'Acoustic specialty stores',\n    link: '',\n    installation: 'professional',\n    description: 'Heavy vinyl barrier for soundproofing walls. Blocks sound transmission.'\n  },\n]\n\n// ===== HELPER FUNCTIONS =====\n\nexport function getProductsByCategory(category: AcousticProduct['category']): AcousticProduct[] {\n  return acousticProductsDB.filter(p => p.category === category)\n}\n\nexport function getProductById(id: string): AcousticProduct | undefined {\n  return acousticProductsDB.find(p => p.id === id)\n}\n\nexport function calculateTreatmentCost(\n  products: { id: string; quantity: number }[],\n  currency: 'USD' | 'ARS' = 'USD'\n): number {\n  return products.reduce((total, item) => {\n    const product = getProductById(item.id)\n    if (!product) return total\n    const price = currency === 'USD' ? product.priceUSD : product.priceARS\n    return total + price * item.quantity\n  }, 0)\n}\n\nexport function getTotalAbsorptionArea(products: { id: string; quantity: number }[]): number {\n  return products.reduce((total, item) => {\n    const product = getProductById(item.id)\n    if (!product || !product.coverage) return total\n    return total + product.coverage * item.quantity\n  }, 0)\n}\n\n// ===== RECOMMENDATION ENGINE =====\n\nexport interface ProductRecommendation {\n  productId: string\n  quantity: number\n  placement: string\n  priority: 'high' | 'medium' | 'low'\n  reason: string\n}\n\n/**\n * Generate product recommendations based on room size and character\n */\nexport function generateProductRecommendations(\n  roomArea: number, // m²\n  _roomVolume: number, // m³ (reserved for future use)\n  roomCharacter: 'viva' | 'equilibrada' | 'seca',\n  budget: 'free' | 'low' | 'advanced'\n): ProductRecommendation[] {\n  const recommendations: ProductRecommendation[] = []\n\n  // Free/DIY recommendations\n  if (budget === 'free') {\n    recommendations.push({\n      productId: 'thick-rug-medium',\n      quantity: 1,\n      placement: 'Between speakers and listening position',\n      priority: 'high',\n      reason: 'Reduces floor reflections and flutter echo'\n    })\n    recommendations.push({\n      productId: 'light-curtain',\n      quantity: Math.ceil(roomArea * 0.15), // Approx window coverage\n      placement: 'Windows and glass surfaces',\n      priority: 'medium',\n      reason: 'Controls window reflections'\n    })\n  }\n\n  // Low budget recommendations\n  if (budget === 'low') {\n    const panelCount = Math.ceil(roomArea / 3) // Rough estimate: 1 panel per 3m² of floor\n\n    recommendations.push({\n      productId: 'foam-panel-5cm',\n      quantity: Math.min(panelCount, 12), // Cap at 12 panels\n      placement: 'First reflection points on side walls',\n      priority: 'high',\n      reason: 'Treats early reflections and reduces flutter echo'\n    })\n\n    if (roomCharacter === 'viva') {\n      recommendations.push({\n        productId: 'corner-bass-trap-60cm',\n        quantity: 4,\n        placement: 'All four corners of the room',\n        priority: 'high',\n        reason: 'Tames excessive bass and room modes'\n      })\n    }\n\n    recommendations.push({\n      productId: 'thick-rug-medium',\n      quantity: 1,\n      placement: 'Floor between speakers and listening position',\n      priority: 'high',\n      reason: 'Critical floor reflection point'\n    })\n\n    recommendations.push({\n      productId: 'isolation-pads',\n      quantity: 1,\n      placement: 'Under speakers',\n      priority: 'medium',\n      reason: 'Decouples speakers from surface, tightens bass'\n    })\n  }\n\n  // Advanced recommendations\n  if (budget === 'advanced') {\n    const wallPanels = Math.ceil(roomArea / 2.5)\n\n    recommendations.push({\n      productId: 'pro-fabric-panel-10cm',\n      quantity: Math.min(wallPanels, 16),\n      placement: 'First reflection points and front wall',\n      priority: 'high',\n      reason: 'Professional broadband absorption for accurate sound'\n    })\n\n    recommendations.push({\n      productId: 'corner-bass-trap-120cm',\n      quantity: 4,\n      placement: 'Floor-to-ceiling in all corners',\n      priority: 'high',\n      reason: 'Maximum low-frequency control'\n    })\n\n    if (roomCharacter !== 'seca') {\n      recommendations.push({\n        productId: 'qrd-diffuser-large',\n        quantity: Math.ceil(roomArea / 12),\n        placement: 'Rear wall behind listening position',\n        priority: 'medium',\n        reason: 'Creates natural spaciousness without over-damping'\n      })\n    }\n\n    recommendations.push({\n      productId: 'ceiling-cloud-panel',\n      quantity: Math.ceil(roomArea / 10),\n      placement: 'Ceiling between speakers and listener',\n      priority: 'medium',\n      reason: 'Controls ceiling reflections'\n    })\n\n    recommendations.push({\n      productId: 'measurement-mic',\n      quantity: 1,\n      placement: 'For room analysis',\n      priority: 'medium',\n      reason: 'Measure and verify improvements with REW software'\n    })\n  }\n\n  return recommendations\n}\n"],"names":[],"mappings":"AAAA,+CAA+C;AAC/C,0CAA0C;;;;;;;;;;;;;;;AAiBnC,MAAM,qBAAwC;IACnD,wBAAwB;IACxB;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,uBAAuB;QACvB,UAAU;QACV,WAAW;QACX,cAAc;QACd,aAAa;IACf;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,uBAAuB;QACvB,UAAU;QACV,WAAW;QACX,cAAc;QACd,aAAa;IACf;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,uBAAuB;QACvB,UAAU;QACV,WAAW;QACX,cAAc;QACd,aAAa;IACf;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,uBAAuB;QACvB,UAAU;QACV,WAAW;QACX,cAAc;QACd,aAAa;IACf;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,uBAAuB;QACvB,UAAU;QACV,WAAW;QACX,cAAc;QACd,aAAa;IACf;IAEA,yBAAyB;IACzB;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,uBAAuB;QACvB,cAAc;QACd,aAAa;IACf;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,uBAAuB;QACvB,cAAc;QACd,aAAa;IACf;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,uBAAuB;QACvB,cAAc;QACd,aAAa;IACf;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,uBAAuB;QACvB,cAAc;QACd,aAAa;IACf;IAEA,wBAAwB;IACxB;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,cAAc;QACd,aAAa;IACf;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,cAAc;QACd,aAAa;IACf;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,cAAc;QACd,aAAa;IACf;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,cAAc;QACd,aAAa;IACf;IAEA,6BAA6B;IAC7B;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,uBAAuB;QACvB,UAAU;QACV,cAAc;QACd,aAAa;IACf;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,uBAAuB;QACvB,UAAU;QACV,cAAc;QACd,aAAa;IACf;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,uBAAuB;QACvB,UAAU;QACV,cAAc;QACd,aAAa;IACf;IAEA,uBAAuB;IACvB;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,uBAAuB;QACvB,cAAc;QACd,aAAa;IACf;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,uBAAuB;QACvB,cAAc;QACd,aAAa;IACf;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,UAAU;QACV,UAAU;QACV,MAAM;QACN,uBAAuB;QACvB,cAAc;QACd,aAAa;IACf;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,UAAU;QACV,U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"}},
    {"offset": {"line": 974, "column": 0}, "map": {"version":3,"sources":["file:///Users/javieroviedo/Documents/v0-room-tuner-mvp/app/api/analyze-room/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport type { RoomProject, EnhancedAnalysisResponse, ProductRecommendation } from \"@/app/types/room\"\nimport {\n  calculateRoomModes,\n  calculateRoomMetrics,\n  calculateTotalAbsorption,\n  estimateRT60ByBand,\n  evaluateRT60,\n  determineRoomCharacter,\n  estimateFrequencyResponse,\n  calculateOptimalPositions,\n} from \"@/lib/acousticsCalculations\"\nimport {\n  generateProductRecommendations,\n  getProductById,\n  calculateTreatmentCost,\n} from \"@/lib/acousticProducts\"\n\nconst N8N_URL = process.env.N8N_ANALYZE_ROOM_WEBHOOK_URL\n\n/**\n * Analyze room and generate comprehensive report\n */\nexport async function POST(req: Request) {\n  try {\n    const project = (await req.json()) as RoomProject\n\n    // Validate required fields\n    if (!project.lengthM || !project.widthM || !project.heightM) {\n      return NextResponse.json(\n        { error: \"Missing room dimensions\" },\n        { status: 400 }\n      )\n    }\n\n    // If N8N webhook is configured, try to use it (for future AI enhancements)\n    if (N8N_URL) {\n      try {\n        const n8nRes = await fetch(N8N_URL, {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            ...project,\n            locale: \"es-AR\",\n            source: \"web-mvp\",\n            version: \"0.2.0\",\n          }),\n          signal: AbortSignal.timeout(5000), // 5 second timeout\n        })\n\n        if (n8nRes.ok) {\n          const data = await n8nRes.json()\n          // If N8N returns enhanced analysis, use it\n          if (data.roomMetrics) {\n            return NextResponse.json(data)\n          }\n        }\n      } catch (n8nError) {\n        console.warn(\"N8N webhook failed, using local analysis:\", n8nError)\n        // Continue with local analysis\n      }\n    }\n\n    // Generate comprehensive analysis locally\n    const analysis = generateLocalAnalysis(project)\n\n    return NextResponse.json(analysis)\n  } catch (error) {\n    console.error(\"Error analyzing room:\", error)\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    )\n  }\n}\n\n/**\n * Generate comprehensive analysis using local calculations\n */\nfunction generateLocalAnalysis(project: RoomProject): EnhancedAnalysisResponse {\n  const { lengthM = 0, widthM = 0, heightM = 0, goal } = project\n\n  // === STEP 1: Calculate room metrics ===\n  const metrics = calculateRoomMetrics(lengthM, widthM, heightM)\n\n  // === STEP 2: Calculate room modes ===\n  const roomModes = calculateRoomModes(lengthM, widthM, heightM)\n\n  // === STEP 3: Calculate absorption ===\n  const absorption = calculateTotalAbsorption(project)\n\n  // === STEP 4: Estimate RT60 ===\n  const rt60 = estimateRT60ByBand(metrics.volume, absorption)\n  const rt60Eval = evaluateRT60(rt60.mid, goal || \"music\")\n\n  // === STEP 5: Determine room character ===\n  const roomCharacter = determineRoomCharacter(\n    rt60.mid,\n    absorption.average,\n    metrics.surfaceArea\n  )\n\n  // === STEP 6: Generate frequency response estimate ===\n  const frequencyResponse = estimateFrequencyResponse(\n    roomModes,\n    roomCharacter,\n    metrics.volume\n  )\n\n  // === STEP 7: Calculate optimal speaker positions ===\n  const positions = calculateOptimalPositions(\n    lengthM,\n    widthM,\n    project.equipmentPosition || \"indefinido\"\n  )\n\n  // === STEP 8: Generate recommendations ===\n\n  // Free recommendations\n  const freeRecommendations = generateFreeRecommendations(project, roomCharacter, positions)\n\n  // Low budget recommendations\n  const lowBudgetRecs = generateProductRecommendations(\n    metrics.floorArea,\n    metrics.volume,\n    roomCharacter,\n    \"low\"\n  )\n  const lowBudgetProducts = convertToProductRecommendations(lowBudgetRecs, \"ARS\")\n  const lowBudgetCost = calculateTreatmentCost(\n    lowBudgetRecs.map((r) => ({ id: r.productId, quantity: r.quantity })),\n    \"ARS\"\n  )\n\n  // Advanced recommendations\n  const advancedRecs = generateProductRecommendations(\n    metrics.floorArea,\n    metrics.volume,\n    roomCharacter,\n    \"advanced\"\n  )\n  const advancedProducts = convertToProductRecommendations(advancedRecs, \"USD\")\n  const advancedCost = calculateTreatmentCost(\n    advancedRecs.map((r) => ({ id: r.productId, quantity: r.quantity })),\n    \"USD\"\n  )\n\n  // === STEP 9: Generate summary ===\n  const summary = generateSummary(project, roomCharacter, metrics, rt60, roomModes)\n\n  // === STEP 10: Create room diagram data ===\n  const roomDiagram = {\n    floorPlan: {\n      width: widthM,\n      length: lengthM,\n      speakerPositions: positions.speakers,\n      listeningPosition: positions.listeningPosition,\n      furnitureLayout: generateFurnitureLayout(project.furniture || [], widthM, lengthM),\n    },\n    treatmentPlan: generateTreatmentPlan(roomCharacter, lowBudgetRecs, advancedRecs),\n  }\n\n  // === STEP 11: Count priorities ===\n  const priorityScore = calculatePriorityScore(roomCharacter, rt60Eval, roomModes)\n\n  // === STEP 12: Assemble final response ===\n  const response: EnhancedAnalysisResponse = {\n    summary,\n    roomCharacter,\n    priorityScore,\n\n    roomMetrics: {\n      ...metrics,\n      roomModes,\n      rt60Estimate: rt60,\n      rt60Evaluation: rt60Eval,\n    },\n\n    materialsAnalysis: {\n      floorAbsorption: absorption.low / metrics.floorArea,\n      wallAbsorption: absorption.mid / metrics.wallArea,\n      ceilingAbsorption: 0.02, // Assumed hard ceiling\n      furnitureContribution: (project.furniture?.length || 0) * 0.3,\n      totalAbsorption: absorption.average,\n    },\n\n    frequencyResponse,\n\n    freeChanges: {\n      title: \"Cambios sin gastar dinero\",\n      items: freeRecommendations,\n    },\n\n    lowBudgetChanges: {\n      title: \"Mejoras con bajo presupuesto (ARS $50k-150k)\",\n      totalEstimatedCost: {\n        min: Math.round(lowBudgetCost * 0.7),\n        max: Math.round(lowBudgetCost * 1.2),\n        currency: \"ARS\",\n      },\n      items: lowBudgetProducts,\n    },\n\n    advancedChanges: {\n      title: \"Soluciones avanzadas (USD $500-2000)\",\n      totalEstimatedCost: {\n        min: Math.round(advancedCost * 0.8),\n        max: Math.round(advancedCost * 1.3),\n        currency: \"USD\",\n      },\n      items: advancedProducts,\n    },\n\n    roomDiagram,\n\n    generatedAt: new Date().toISOString(),\n  }\n\n  return response\n}\n\n// ===== HELPER FUNCTIONS =====\n\n/**\n * Generate free (no cost) recommendations\n */\nfunction generateFreeRecommendations(\n  project: RoomProject,\n  roomCharacter: \"viva\" | \"equilibrada\" | \"seca\",\n  positions: ReturnType<typeof calculateOptimalPositions>\n): string[] {\n  const recommendations: string[] = []\n\n  // Speaker placement\n  recommendations.push(...positions.recommendations)\n\n  // Listening position advice\n  recommendations.push(\n    \"Evitar punto de escucha exactamente en el centro de la sala (50% de profundidad)\"\n  )\n\n  // Room character specific\n  if (roomCharacter === \"viva\") {\n    recommendations.push(\n      \"Agregar mantas gruesas en las paredes para absorción temporal\"\n    )\n    recommendations.push(\n      \"Colocar almohadones en las esquinas para reducir acumulación de graves\"\n    )\n    recommendations.push(\"Abrir puertas de placares para añadir absorción difusa\")\n  } else if (roomCharacter === \"seca\") {\n    recommendations.push(\n      \"Remover exceso de materiales absorbentes si la sala suena muy apagada\"\n    )\n    recommendations.push(\n      \"Mantener superficies duras y lisas para preservar brillo natural\"\n    )\n  } else {\n    recommendations.push(\n      \"La sala tiene buen balance, enfocarse en optimizar posiciones\"\n    )\n  }\n\n  // Furniture recommendations\n  if (!project.furniture || project.furniture.length === 0) {\n    recommendations.push(\n      \"Agregar muebles como biblioteca o sofá para romper reflexiones paralelas\"\n    )\n  }\n\n  // General tips\n  recommendations.push(\n    \"Despejar espacio entre parlantes y paredes (mínimo 30cm)\"\n  )\n  recommendations.push(\n    \"Experimentar con pequeños cambios de posición antes de comprar tratamiento\"\n  )\n\n  return recommendations\n}\n\n/**\n * Convert product recommendations to full product objects\n */\nfunction convertToProductRecommendations(\n  recommendations: ReturnType<typeof generateProductRecommendations>,\n  currency: \"USD\" | \"ARS\"\n): ProductRecommendation[] {\n  return recommendations.map((rec) => {\n    const product = getProductById(rec.productId)\n    if (!product) {\n      throw new Error(`Product not found: ${rec.productId}`)\n    }\n\n    const unitPrice = currency === \"USD\" ? product.priceUSD : product.priceARS\n    const totalPrice = unitPrice * rec.quantity\n\n    return {\n      productId: rec.productId,\n      product: product.name,\n      category: product.category,\n      quantity: rec.quantity,\n      unitPrice,\n      totalPrice,\n      currency,\n      supplier: product.supplier,\n      link: product.link,\n      placement: rec.placement,\n      impactLevel: rec.priority,\n      installation: product.installation,\n    }\n  })\n}\n\n/**\n * Generate executive summary\n */\nfunction generateSummary(\n  project: RoomProject,\n  roomCharacter: \"viva\" | \"equilibrada\" | \"seca\",\n  metrics: ReturnType<typeof calculateRoomMetrics>,\n  rt60: { low: number; mid: number; high: number },\n  roomModes: ReturnType<typeof calculateRoomModes>\n): string {\n  const goal =\n    project.goal === \"music\"\n      ? \"escuchar música\"\n      : project.goal === \"instrument\"\n        ? \"tocar instrumento\"\n        : \"trabajar y concentrarse\"\n\n  const characterDesc = {\n    viva: \"viva (reverberante)\",\n    equilibrada: \"equilibrada\",\n    seca: \"seca (muy absorbente)\",\n  }[roomCharacter]\n\n  const problematicModes = roomModes.filter(\n    (m) => m.frequency < 200 && m.severity === \"high\"\n  )\n\n  let summary = `Análisis para sala de ${metrics.volume.toFixed(1)}m³ optimizada para ${goal}. `\n  summary += `La sala tiene carácter acústico ${characterDesc} con RT60 promedio de ${rt60.mid.toFixed(2)}s. `\n\n  if (roomCharacter === \"viva\") {\n    summary += `Se recomienda agregar absorción para controlar reverberación excesiva. `\n  } else if (roomCharacter === \"seca\") {\n    summary += `La sala es muy absorbente, considerar agregar difusión para recuperar vitalidad. `\n  } else {\n    summary += `El balance acústico es bueno, enfocarse en tratamiento de puntos específicos. `\n  }\n\n  if (problematicModes.length > 0) {\n    summary += `Se detectaron ${problematicModes.length} modos problemáticos en graves (${problematicModes\n      .slice(0, 3)\n      .map((m) => `${m.frequency.toFixed(0)}Hz`)\n      .join(\", \")}), requieren trampas de graves en esquinas.`\n  }\n\n  return summary\n}\n\n/**\n * Generate furniture layout for diagram\n */\nfunction generateFurnitureLayout(\n  furniture: string[],\n  width: number,\n  length: number\n): Array<{\n  type: string\n  x: number\n  y: number\n  width: number\n  length: number\n}> {\n  const layout: Array<{\n    type: string\n    x: number\n    y: number\n    width: number\n    length: number\n  }> = []\n\n  furniture.forEach((item, index) => {\n    // Simple placement algorithm - spread furniture around the room\n    const angle = (index / furniture.length) * Math.PI * 2\n    const radiusX = width * 0.3\n    const radiusY = length * 0.3\n\n    layout.push({\n      type: item,\n      x: 0.5 + Math.cos(angle) * (radiusX / width),\n      y: 0.5 + Math.sin(angle) * (radiusY / length),\n      width: 0.15, // Normalized size\n      length: 0.15,\n    })\n  })\n\n  return layout\n}\n\n/**\n * Generate treatment plan for diagram\n */\nfunction generateTreatmentPlan(\n  roomCharacter: \"viva\" | \"equilibrada\" | \"seca\",\n  lowBudget: ReturnType<typeof generateProductRecommendations>,\n  advanced: ReturnType<typeof generateProductRecommendations>\n): Array<{\n  type: \"absorber\" | \"diffuser\" | \"bass_trap\"\n  position: { x: number; y: number }\n  wall: \"front\" | \"back\" | \"left\" | \"right\" | \"ceiling\"\n  priority: \"high\" | \"medium\" | \"low\"\n}> {\n  const plan: Array<{\n    type: \"absorber\" | \"diffuser\" | \"bass_trap\"\n    position: { x: number; y: number }\n    wall: \"front\" | \"back\" | \"left\" | \"right\" | \"ceiling\"\n    priority: \"high\" | \"medium\" | \"low\"\n  }> = []\n\n  // Always recommend corner bass traps\n  plan.push(\n    { type: \"bass_trap\", position: { x: 0, y: 0 }, wall: \"front\", priority: \"high\" },\n    { type: \"bass_trap\", position: { x: 1, y: 0 }, wall: \"front\", priority: \"high\" },\n    { type: \"bass_trap\", position: { x: 0, y: 1 }, wall: \"back\", priority: \"high\" },\n    { type: \"bass_trap\", position: { x: 1, y: 1 }, wall: \"back\", priority: \"high\" }\n  )\n\n  // First reflection points (side walls)\n  plan.push(\n    { type: \"absorber\", position: { x: 0, y: 0.3 }, wall: \"left\", priority: \"high\" },\n    { type: \"absorber\", position: { x: 1, y: 0.3 }, wall: \"right\", priority: \"high\" }\n  )\n\n  // Rear diffusion (if not too dead)\n  if (roomCharacter !== \"seca\") {\n    plan.push(\n      { type: \"diffuser\", position: { x: 0.5, y: 1 }, wall: \"back\", priority: \"medium\" }\n    )\n  }\n\n  return plan\n}\n\n/**\n * Calculate priority scores\n */\nfunction calculatePriorityScore(\n  roomCharacter: \"viva\" | \"equilibrada\" | \"seca\",\n  rt60Eval: { rating: \"good\" | \"acceptable\" | \"problematic\" },\n  roomModes: ReturnType<typeof calculateRoomModes>\n): {\n  critical: number\n  improvements: number\n  optimizations: number\n} {\n  let critical = 0\n  let improvements = 0\n  let optimizations = 0\n\n  // RT60 issues\n  if (rt60Eval.rating === \"problematic\") {\n    critical += 1\n  } else if (rt60Eval.rating === \"acceptable\") {\n    improvements += 1\n  }\n\n  // Room modes\n  const problematicModes = roomModes.filter(\n    (m) => m.frequency < 200 && m.severity === \"high\"\n  )\n  critical += Math.min(problematicModes.length, 3)\n\n  // Room character\n  if (roomCharacter === \"viva\") {\n    improvements += 2 // Needs absorption\n  } else if (roomCharacter === \"seca\") {\n    improvements += 1 // Might need diffusion\n  } else {\n    optimizations += 3 // Just fine-tuning\n  }\n\n  // Always some optimizations possible\n  optimizations += 2\n\n  return { critical, improvements, optimizations }\n}\n"],"names":[],"mappings":"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"}}]
}