{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/javieroviedo/Documents/v0-room-tuner-mvp/app/api/analyze-room/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport type { RoomProject } from \"@/app/types/room\"\nimport type { AnalyzeRoomResponse } from \"@/lib/roomStore\"\n\nconst N8N_URL = process.env.N8N_ANALYZE_ROOM_WEBHOOK_URL\n\nconst FALLBACK_ANALYSIS: AnalyzeRoomResponse = {\n  summary:\n    \"No pudimos contactar al motor externo de análisis. Este es un diagnóstico genérico de respaldo.\",\n  roomCharacter: \"viva\",\n  freeChanges: {\n    title: \"Cambios sin gastar dinero\",\n    items: [\n      \"Alejá el punto de escucha al menos 30–50 cm de la pared trasera.\",\n      \"Evitá colocar los parlantes pegados a las esquinas.\",\n    ],\n  },\n  lowBudgetChanges: {\n    title: \"Cambios con bajo presupuesto\",\n    items: [\n      \"Colocá una alfombra entre vos y los parlantes.\",\n      \"Agregá cortinas más pesadas a las ventanas principales.\",\n    ],\n  },\n  advancedChanges: {\n    title: \"Para llevar la sala al siguiente nivel\",\n    items: [\n      \"Instalá paneles absorbentes en los puntos de primeras reflexiones.\",\n      \"Sumá trampas de graves en las esquinas traseras.\",\n    ],\n  },\n}\n\nexport async function POST(req: Request) {\n  const body = (await req.json()) as RoomProject\n\n  if (!N8N_URL) {\n    console.error(\"N8N_ANALYZE_ROOM_WEBHOOK_URL no configurada\")\n    // devolvemos fallback en vez de 500\n    return NextResponse.json(FALLBACK_ANALYSIS)\n  }\n\n  try {\n    const n8nRes = await fetch(N8N_URL, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        ...body,\n        locale: \"es-AR\",\n        source: \"web-mvp\",\n        version: \"0.1.0\",\n      }),\n    })\n\n    if (!n8nRes.ok) {\n      const text = await n8nRes.text()\n      console.error(\"n8n error:\", text)\n      return NextResponse.json(FALLBACK_ANALYSIS)\n    }\n\n    const data = (await n8nRes.json()) as AnalyzeRoomResponse\n    return NextResponse.json(data)\n  } catch (err) {\n    console.error(\"Error llamando a n8n:\", err)\n    return NextResponse.json(FALLBACK_ANALYSIS)\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAIA,MAAM,UAAU,QAAQ,GAAG,CAAC,4BAA4B;AAExD,MAAM,oBAAyC;IAC7C,SACE;IACF,eAAe;IACf,aAAa;QACX,OAAO;QACP,OAAO;YACL;YACA;SACD;IACH;IACA,kBAAkB;QAChB,OAAO;QACP,OAAO;YACL;YACA;SACD;IACH;IACA,iBAAiB;QACf,OAAO;QACP,OAAO;YACL;YACA;SACD;IACH;AACF;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,OAAQ,MAAM,IAAI,IAAI;IAE5B,IAAI,CAAC,SAAS;QACZ,QAAQ,KAAK,CAAC;QACd,oCAAoC;QACpC,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B;IAEA,IAAI;QACF,MAAM,SAAS,MAAM,MAAM,SAAS;YAClC,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,GAAG,IAAI;gBACP,QAAQ;gBACR,QAAQ;gBACR,SAAS;YACX;QACF;QAEA,IAAI,CAAC,OAAO,EAAE,EAAE;YACd,MAAM,OAAO,MAAM,OAAO,IAAI;YAC9B,QAAQ,KAAK,CAAC,cAAc;YAC5B,OAAO,gJAAY,CAAC,IAAI,CAAC;QAC3B;QAEA,MAAM,OAAQ,MAAM,OAAO,IAAI;QAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B;AACF"}}]
}